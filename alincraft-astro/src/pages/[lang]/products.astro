---
import Layout from '../../layouts/Layout.astro';
import LangSwitcher from '../../components/LangSwitcher.astro';
import { getLangContent, getText, langNames } from '../../i18n/translations';
import { products } from '../../data/products';

export function getStaticPaths() {
  const locales = ['en', 'zh-CN', 'zh-TW', 'ja', 'ko', 'pt', 'pt-BR', 'es', 'fr', 'de', 'it', 'ru', 'ar', 'hi', 'th', 'vi', 'id', 'ms', 'tr', 'pl', 'nl'];
  return locales.map(lang => ({ params: { lang } }));
}

const { lang } = Astro.params;
const locale = lang || 'en';
const t = (key: string) => getText(locale, key);
const contact = getLangContent(locale, 'contact');

// Helper function to get product name in current language
function getProductName(product: any) {
  if (locale.startsWith('zh')) {
    return product.nameZh || product.name;
  } else if (locale === 'ja' && product.nameJa) {
    return product.nameJa;
  } else if (locale === 'ko' && product.nameKo) {
    return product.nameKo;
  }
  return product.name;
}

// Helper function to get product description in current language
function getProductDescription(product: any) {
  if (locale === 'zh-CN' || locale === 'zh-TW') {
    return product.descriptionZh || product.description;
  } else if (locale === 'ja') {
    return product.descriptionJa || product.descriptionZh || product.description;
  } else if (locale === 'ko') {
    return product.descriptionZh || product.description;
  }
  return product.description;
}
---

<Layout title={`${t('products')} | Alin Handcraft`} lang={locale}>
  <LangSwitcher currentLocale={locale} />
  
  <header>
    <div class="container" style="display: flex; justify-content: space-between; align-items: center; padding: 24px 24px;">
      <h1 class="logo"><a href={`/${locale === 'en' ? '' : locale + '/'}`}>{t('logo')}</a></h1>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container">
        <h1>{t('products')}</h1>
        <p class="tagline">{t('productsTagline')}</p>
      </div>
    </section>

    <section class="products">
      <div class="container">
        <div class="products-grid">
          {products.map((product, index) => (
            <a href={`/${locale}/product/${product.id}`} class="product-card">
              <div class="product-image">
                <img src={product.image} alt={getProductName(product)} />
                {product.isDigital && <span class="badge digital">Digital</span>}
                <div class="product-overlay">
                  <span>{t('viewDetails')}</span>
                </div>
              </div>
              <div class="product-info">
                <h3>{getProductName(product)}</h3>
                <p class="description">
                  {getProductDescription(product).slice(0, 120)}...
                </p>
                <p class="price">${product.price} {product.currency}</p>
                {product.sizes && (
                  <p class="sizes">{product.sizes.join(' / ')}</p>
                )}
              </div>
            </a>
          ))}
        </div>
      </div>
    </section>

    <section class="contact">
      <div class="container">
        <h2>{contact.title}</h2>
        <div class="contact-content">
          <p>{contact.address}</p>
          <p>{contact.wechat}</p>
          <p>{contact.cta}</p>
          <p><a href="mailto:service@alincraft.com">{contact.email || 'service@alincraft.com'}</a></p>
          <p><a href="https://amigucustom.etsy.com" target="_blank">{contact.etsy}</a></p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>{t('footer')}</p>
  </footer>
</Layout>

<style>
  header { padding: 20px 0; }
  .logo { font-size: 24px; font-weight: 300; letter-spacing: 4px; }
  .logo a { color: inherit; text-decoration: none; }
  
  .hero { text-align: center; padding: 60px 0; }
  .hero h1 { font-size: 36px; font-weight: 300; margin-bottom: 16px; }
  .tagline { font-size: 14px; color: #888; letter-spacing: 2px; }
  
  section { margin-bottom: 80px; }
  h2 { font-size: 18px; font-weight: 400; text-align: center; letter-spacing: 4px; color: #666; margin-bottom: 40px; }
  
  .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 40px; }
  
  .product-card {
    display: block;
    background: #FFF;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    transition: transform 0.3s;
    color: inherit;
    text-decoration: none;
  }
  
  .product-card:hover { transform: translateY(-4px); }
  
  .product-image { position: relative; aspect-ratio: 1; overflow: hidden; }
  .product-image img { width: 100%; height: 100%; object-fit: cover; }
  
  .product-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s;
  }
  
  .product-overlay span { color: #fff; font-size: 14px; letter-spacing: 2px; }
  
  .product-card:hover .product-overlay { opacity: 1; }
  
  .badge {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 500;
  }
  
  .badge.digital { background: #4A4A4A; color: #FFF; }
  
  .product-info { padding: 24px; }
  .product-info h3 { font-size: 16px; font-weight: 400; margin-bottom: 12px; }
  .product-info .description { font-size: 13px; color: #888; line-height: 1.6; margin-bottom: 16px; }
  .product-info .price { font-size: 20px; font-weight: 500; color: #4A4A4A; margin-bottom: 8px; }
  .product-info .sizes { font-size: 12px; color: #AAA; margin-bottom: 16px; }
  
  .contact-content { text-align: center; font-size: 14px; color: #666; }
  .contact-content p { margin-bottom: 12px; }
  .contact-content a { color: #4A4A4A; text-decoration: underline; }
  
  footer { text-align: center; padding: 60px 0; font-size: 12px; color: #AAA; letter-spacing: 2px; }
  
  @media (max-width: 600px) {
    .hero { padding: 40px 0; }
    .hero h1 { font-size: 24px; }
    section { margin-bottom: 60px; }
    .products-grid { grid-template-columns: 1fr; }
  }
</style>
