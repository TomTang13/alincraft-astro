---
interface Props {
  currentLocale: string;
}

const { currentLocale } = Astro.props;
import { langNames } from '../i18n/translations';

const locales = Object.keys(langNames);
---

<div class="lang-switcher">
  <select 
    id="lang-select" 
    class="lang-select"
  >
    {locales.map(locale => (
      <option 
        value={locale}
        selected={currentLocale === locale}
      >
        {langNames[locale]}
      </option>
    ))}
  </select>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const select = document.getElementById('lang-select');
    if (!select) return;
    
    select.addEventListener('change', (e) => {
      const newLocale = e.target.value;
      switchToLanguage(newLocale);
    });
  });

  function switchToLanguage(newLocale) {
    const path = window.location.pathname;
    
    // 直接从URL提取当前语言
    const match = path.match(/^\/([a-z]{2}(-[A-Z]{2})?)\//);
    let currentLang = match ? match[1] : 'en';
    let cleanPath = path;
    
    // 去掉当前语言前缀
    if (currentLang === 'en') {
      cleanPath = path.replace(/^\/en\//, '/');
    } else {
      cleanPath = path.replace(/^\/[a-z]{2}(-[A-Z]{2})?\//, '/');
    }
    
    // 构建新路径
    let newPath;
    if (newLocale === 'en') {
      newPath = cleanPath === '/' ? '/' : `/en${cleanPath}`;
    } else {
      newPath = `/${newLocale}${cleanPath}`;
    }
    
    // 跳转
    window.location.href = newPath;
  }
</script>

<style>
  .lang-switcher {
    position: fixed;
    top: 20px;
    right: 24px;
    z-index: 100;
  }
  
  .lang-select {
    padding: 6px 12px;
    border: 1px solid #DDD;
    background: #FDFBF7;
    border-radius: 20px;
    font-size: 12px;
    cursor: pointer;
    outline: none;
  }
  
  .lang-select:hover {
    border-color: #BBB;
  }
</style>
