---
interface Props {
  title: string;
  description?: string;
  lang?: 'zh' | 'en';
  image?: string;
}

const { title, description = '阿琳手作工作室 - 手工编织玩偶专卖店', lang = 'zh', image = '/images/og-default.jpg' } = Astro.props;
const currentLang = lang;
const canonicalURL = `https://alincraft.com${Astro.url.pathname.replace(/\/$/, '')}`;

// SEO 策略: 只索引主语言 (en)，其他语言 noindex
const isMainLanguage = currentLang === 'en';
const mainLanguageURL = isMainLanguage ? canonicalURL : `https://alincraft.com${Astro.url.pathname.replace(/\/[a-z]{2}(-[A-Z]{2})?\//, '/en/').replace(/\/$/, '')}`;
---

<!doctype html>
<html lang={currentLang}>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  <meta name="description" content={description}>
  <link rel="icon" type="image/jpeg" href="/favicon.jpg">
  <link rel="canonical" href={canonicalURL}>
  
  {/* SEO: 主语言索引，其他语言 noindex */}
  {isMainLanguage ? (
    <>
      <meta name="robots" content="index, follow" />
      <link rel="alternate" hreflang="x-default" href={mainLanguageURL} />
    </>
  ) : (
    <meta name="robots" content="noindex, follow" />
  )}
  
  <!-- Open Graph -->
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={`https://alincraft.com${image}`}>
  <meta property="og:url" content={canonicalURL}>
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Alin Handcraft">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content={title}>
  <meta name="twitter:description" content={description}>
  <meta name="twitter:image" content={`https://alincraft.com${image}`}>
  
  <!-- JSON-LD LocalBusiness -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": ["Store", "LocalBusiness"],
    "name": "阿琳手作工作室 | Alin Handcraft",
    "description": "手工编织玩偶专卖店，提供定制宠物纪念玩偶服务",
    "url": "https://alincraft.com",
    "logo": "https://alincraft.com/favicon.jpg",
    "image": "https://alincraft.com/images/og-default.jpg",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Shanghai",
      "addressCountry": "CN"
    },
    "priceRange": "$$$",
    "paymentAccepted": "PayPal, Etsy",
    "currenciesAccepted": "USD, CNY"
  })} />
  
  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MMM9V568CN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-MMM9V568CN');
  </script>
</head>
<body>
  <slot />
</body>
</html>

<style is:global>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; background-color: #FDFBF7; color: #4A4A4A; line-height: 1.8; }
  .container { max-width: 900px; margin: 0 auto; padding: 0 24px; }
  a { color: inherit; text-decoration: none; }
  img { max-width: 100%; height: auto; }
</style>
